//show projects
var projectlist = "";
for (const key in localStorage) {
    if (Object.hasOwnProperty.call(localStorage, key)) {
        const element = localStorage[key];
        if (key.endsWith('ct')){
            var pname = key.replace('_ct','');
            var ptype = localStorage[pname];
            projectlist = projectlist + '<div class="tile" onclick=openProject("'+pname+'","'+ptype+'")> :: '+ptype.toUpperCase()+'/'+pname+'</div>';
        }
    }
}
document.getElementById("plist").innerHTML = projectlist;
var showTemplates = () => {
    document.getElementById("templates").style.display = "block";
}
var closeTemplates = () => {
    document.getElementById("templates").style.display = "none";
}
var openProject = (pname, ptype) => {
    window.location.assign(ptype+"/index.html?name="+pname);
}
var useTemplate = (ptype, ptemplate) => {
    var pname = document.getElementById("pname").value;
    if (pname == null || pname == "") {
        pname = "project_"+Math.floor(Math.random()*10000);
    } else {
        pname = pname.replaceAll(' ','_');
    }
    //save template to localStorage
    if (ptype = "2d") {
        localStorage[pname] = "2d";
        
        switch (ptemplate) {
            case "blank":
                var charactersjs = "// @michael_abia_v1 2022\n// Characters Created with Game Engine";
                var loopjs = "// @michael_abia_v1 2022\n// Frame Logic Created with Game Engine\n\nvar gameLoop = () => {\n \tvar canvas = document.getElementById('screen');\n    var cursor = canvas.getContext('2d');\n    cursor.canvas.width = Game.width;\n    cursor.canvas.height = Game.height;\n  \tcursor.setTransform(1, 0, 0, 1, 0, 0);\n    cursor.clearRect(0, 0, Game.width, Game.height);\n    Game.time = Math.floor((performance.now() - Game.firstFrame)/1000);\n\n    if (Game.grid) {\n        graph(cursor);\n    }\n\n    if (Game.fps){\n        fps();\n    }\n\n    if (Game.play){\n        window.requestAnimationFrame(gameLoop);\n\n        for(asset in Game.assets) {\n          \t\n          \tvar character = Game.assets[asset];\n          \tdrawCharacter(cursor, character);\n          \t\n          \t//#Time-Events\n          \t\n          \t\n            //#Key-Events\n            \n          \t\n            for (box in Game.collisionGraph) {\n              \tvar collider = Game.assets[box];\n            \tif (character.name != collider.name){\n                \tif (((character.x <= collider.x+collider.width && character.x >= collider.x) || (character.x+character.width >= collider.x && character.x+character.width <= collider.x+collider.width)) && ((character.y <= collider.y+collider.height && character.y >= collider.y) || (character.y+character.height >= collider.y && character.y+character.height <= collider.y+collider.height))){\n                    \t//#Collision-Events\n                      \t\n                    }\n            \t}\n           \t};\n            \n          \t\n        };\n    } else {\n        window.cancelAnimationFrame(gameLoop);\n    }   \n}";
                localStorage[pname+"_ct"] = charactersjs;
                localStorage[pname+"_lt"] = loopjs;
                break;
            case "ground":
                var charactersjs = "// @michael_abia_v1 2022\n// Characters Created with Game Engine\n\nvar backgroundOne = new Character({\n    'name':'backg',\n  \t'visible':true,\n  \t'instance':0,\n    'x':Game.height,\n    'y':0,\n    'width':Game.height,\n    'height':Game.height,\n    'direction': 0,\n    'speed':0,\n    'angspeed':0,\n    'maxspeed':0,\n    'minspeed':0,\n    'link':'../assets/concrete.png',\n    'input':{},\n  \t'custom':{}\n});\n\nvar backgroundTwo = new Character({\n    'name':'backg2',\n  \t'visible':true,\n  \t'instance':0,\n    'x':0,\n    'y':0,\n    'width':Game.height,\n    'height':Game.height,\n    'direction': 0,\n    'speed':0,\n    'angspeed':0,\n    'maxspeed':0,\n    'minspeed':0,\n    'link':'../assets/grass.png',\n    'input':{},\n  \t'custom':{}\n});\n\nvar collisionOne = new Character({\n    'name':'health',\n  \t'visible':true,\n  \t'instance':0,\n    'x':400,\n    'y':700,\n    'width':50,\n    'height':50,\n    'direction': 0,\n    'speed':0,\n    'angspeed':0,\n    'maxspeed':0,\n    'minspeed':0,\n    'link':'../assets/health.png',\n    'input':{},\n  \t'custom':{}\n});\n\n\nvar nonplayerOne = new Character({\n    'name':'luigi',\n  \t'visible':true,\n  \t'instance':0,\n    'x':50,\n    'y':50,\n    'width':200,\n    'height':400,\n    'direction': 0,\n    'speed':0,\n    'angspeed':0,\n    'maxspeed':20,\n    'minspeed':0,\n    'link':'../assets/anim.png',\n    'input':{'ArrowUp':true, 'ArrowDown':true, 'ArrowLeft':true, 'ArrowRight':true},\n  \t'custom':{}\n});\n\nvar playerOne = new Character({\n    'name':'mario',\n  \t'visible':true,\n  \t'instance':0,\n    'x':Game.width/2,\n    'y':Game.height/2,\n    'width':200,\n    'height':400,\n    'direction': 0,\n    'speed':0,\n    'angspeed':0,\n    'maxspeed':5,\n    'minspeed':0,\n    'link':'../assets/anim.png',\n    'input':{'KeyW':true, 'KeyA':true, 'KeyS':true, 'KeyD':true, 'Click':true},\n  \t'custom':{}\n});\n\nvar instanceOne = new Character({\n    'name':'bullet',\n  \t'visible':false,\n  \t'instance':1,\n    'x':Game.width/2,\n    'y':50,\n    'width':10,\n    'height':40,\n    'direction': 90,\n    'speed':0,\n    'angspeed':0,\n    'maxspeed':20,\n    'minspeed':0,\n    'link':'../assets/bullet.png',\n    'input':{},\n  \t'custom':{}\n});";
                var loopjs = "// @michael_abia_v1 2022\n// Frame Logic Created with Game Engine\n\nvar gameLoop = () => {\n \tvar canvas = document.getElementById('screen');\n    var cursor = canvas.getContext('2d');\n    cursor.canvas.width = Game.width;\n    cursor.canvas.height = Game.height;\n  \tcursor.setTransform(1, 0, 0, 1, 0, 0);\n    cursor.clearRect(0, 0, Game.width, Game.height);\n    Game.time = Math.floor((performance.now() - Game.firstFrame)/1000);\n\n    if (Game.grid) {\n        graph(cursor);\n    }\n\n    if (Game.fps){\n        fps();\n    }\n\n    if (Game.play){\n        window.requestAnimationFrame(gameLoop);\n\n        for(asset in Game.assets) {\n          \t\n          \tvar character = Game.assets[asset];\n          \tdrawCharacter(cursor, character);\n          \t\n          \t//#Time-Events\n          \tif (Game.time >= 3 && Game.time <= 5 && character.name == 'luigi'){\n              \tcharacter.playsound(true, '../assets/bgmusic.mp3');\n            \tcharacter.showtext(cursor, 'Come Outside!', 28, 'bottom');\n            }\n          \t\n            //#Key-Events\n            if (Game.key['KeyW'] && character.input['KeyW']){\n              \tcharacter.direction = 0;\n                character.move(4);\n              \tcharacter.animate(['../assets/anim_0.png', '../assets/anim_1.png', '../assets/anim_2.png', '../assets/anim_3.png', '../assets/anim_4.png', '../assets/anim_5.png', '../assets/anim_6.png', '../assets/anim_7.png'], asset);\n            }\n          \tif (Game.key['KeyA'] && character.input['KeyA']){\n              \tcharacter.direction = 270;\n                character.move(4);\n              \tcharacter.animate(['../assets/anim_0.png', '../assets/anim_1.png', '../assets/anim_2.png', '../assets/anim_3.png', '../assets/anim_4.png', '../assets/anim_5.png', '../assets/anim_6.png', '../assets/anim_7.png'], asset);\n            }\n          \tif (Game.key['KeyS'] && character.input['KeyS']){\n              \tcharacter.direction = 180;\n                character.move(4);\n              \tcharacter.animate(['../assets/anim_0.png', '../assets/anim_1.png', '../assets/anim_2.png', '../assets/anim_3.png', '../assets/anim_4.png', '../assets/anim_5.png', '../assets/anim_6.png', '../assets/anim_7.png'], asset);\n            }\n          \tif (Game.key['KeyD'] && character.input['KeyD']){\n              \tcharacter.direction = 90;\n                character.move(4);\n              \tcharacter.animate(['../assets/anim_0.png', '../assets/anim_1.png', '../assets/anim_2.png', '../assets/anim_3.png', '../assets/anim_4.png', '../assets/anim_5.png', '../assets/anim_6.png', '../assets/anim_7.png'], asset);\n            }\n          \tif (Game.click && character.input['Click']){\n              \tinstanceOne.playsound(false, '../assets/shoot.mp3');\n    \t\t\tspawn(instanceOne, character.x+(character.width/2), character.y+(character.height/2), character.getvector(-character.x, -character.y, Game.mousePosition.x, Game.mousePosition.y).direction);\n              \tGame.click = false;\n            }\n          \t\n            for (box in Game.collisionGraph) {\n              \tvar collider = Game.assets[box];\n            \tif (character.name != collider.name){\n                \tif (((character.x <= collider.x+collider.width && character.x >= collider.x) || (character.x+character.width >= collider.x && character.x+character.width <= collider.x+collider.width)) && ((character.y <= collider.y+collider.height && character.y >= collider.y) || (character.y+character.height >= collider.y && character.y+character.height <= collider.y+collider.height))){\n                    \t//#Collision-Events\n                      \tif (character.name == 'bullet' && collider.name == 'luigi'){\n                            collider.showimage('../assets/explode.png', box);\n                          \tcollider.showtext(cursor, 'x_x', 40, 'bottom');\n                        }\n                      \t\n                      \tif (character.name == 'health' && collider.name == 'mario'){\n                          \tcharacter.showimage('../assets/rock.png', asset);\n                            character.playsound(false, '../assets/game_over.mp3');\n                        }\n                    }\n            \t}\n           \t};\n            \n          \tif (character.name == 'bullet'){\n          \t\tcharacter.move(10);\n              \tif (character.x > Game.width || character.y > Game.height){\n                  \tdespawn(asset);\n                }\n            }\n          \n          \tif (character.name == 'mario'){\n              \tcharacter. direction = character.getvector(-character.x, -character.y, Game.mousePosition.x, Game.mousePosition.y).direction;\n            }\n        };\n    } else {\n        window.cancelAnimationFrame(gameLoop);\n    }   \n}";
                localStorage[pname+"_ct"] = charactersjs;
                localStorage[pname+"_lt"] = loopjs;
                break;
            case "space":
                var charactersjs = "// @michael_abia_v1 2022\n// Characters Created with Game Engine\n\nvar backgroundOne = new Character({\n\t'name':'space',\n\t'visible':true,\n\t'instance':0,\n\t'x':0,\n\t'y':0,\n\t'width':Game.width,\n\t'height':Game.height,\n\t'direction': 0,\n\t'speed':0,\n\t'angspeed':0,\n\t'maxspeed':20,\n\t'minspeed':0,\n\t'link':'../assets/space.png',\n\t'input':{},\n\t'custom':{}\n});\n\nvar collisionOne = new Character({\n\t'name':'planet',\n\t'visible':true,\n\t'instance':0,\n\t'x':50,\n\t'y':200,\n\t'width':400,\n\t'height':400,\n\t'direction': 0,\n\t'speed':0,\n\t'angspeed':0,\n\t'maxspeed':20,\n\t'minspeed':0,\n\t'link':'../assets/planet.png',\n\t'input':{'Click':true},\n\t'custom':{'targets': 1, 'lasthad':Game.time}\n});\n\nvar playerOne = new Character({\n\t'name':'ship',\n\t'visible':true,\n\t'instance':0,\n\t'x':(Game.width/2)-200,\n\t'y':Game.height/2,\n\t'width':40,\n\t'height':70,\n\t'direction': 0,\n\t'speed':0,\n\t'angspeed':0,\n\t'maxspeed':20,\n\t'minspeed':0,\n\t'link':'../assets/ship.png',\n\t'input':{'KeyW':true, 'KeyA':true, 'KeyS':true, 'KeyD':true, 'Click':true},\n\t'custom':{'bullets': 0, 'lastshot':Game.time}\n});\n\nvar instanceOne = new Character({\n    'name':'bullet',\n  \t'visible':false,\n  \t'instance':1,\n    'x':Game.width/2,\n    'y':50,\n    'width':10,\n    'height':40,\n    'direction': 90,\n    'speed':0,\n    'angspeed':0,\n    'maxspeed':20,\n    'minspeed':0,\n    'link':'../assets/bullet.png',\n    'input':{},\n  \t'custom':{}\n});\n\nvar instanceTwo = new Character({\n    'name':'rock',\n  \t'visible':false,\n  \t'instance':1,\n    'x':Game.width,\n    'y':350,\n    'width':40,\n    'height':40,\n    'direction': 0,\n    'speed':0,\n    'angspeed':0,\n    'maxspeed':2,\n    'minspeed':0,\n    'link':'../assets/rock.png',\n    'input':{},\n  \t'custom':{'destroyed':0}\n});";
                var loopjs = "// @michael_abia_v1 2022\n// Frame Logic Created with Game Engine\n\nvar gameLoop = () => {\n \tvar canvas = document.getElementById('screen');\n    var cursor = canvas.getContext('2d');\n    cursor.canvas.width = Game.width;\n    cursor.canvas.height = Game.height;\n  \tcursor.setTransform(1, 0, 0, 1, 0, 0);\n    cursor.clearRect(0, 0, Game.width, Game.height);\n    Game.time = Math.floor((performance.now() - Game.firstFrame)/1000);\n\n    if (Game.grid) {\n        graph(cursor);\n    }\n\n    if (Game.fps){\n        fps();\n    }\n\n    if (Game.play){\n        window.requestAnimationFrame(gameLoop);\n\n        for(asset in Game.assets) {\n          \t\n          \tvar character = Game.assets[asset];\n          \tdrawCharacter(cursor, character);\n          \t\n          \t//#Time-Events\n          \tif (Game.time >= 1 && Game.time <= 3 && character.name == 'planet'){\n              \tcharacter.playsound(true, '../assets/bgmusic2.mp3');\n            \tcharacter.showtext(cursor, 'Stop those Asteroids!', 28, 'top');\n            }\n          \tif (Game.time % 4 == 0 && Game.time > 5 && character.custom.targets == 1){\n             \tif (character.name == 'planet'){\n                  \tvar randY = Math.floor(Math.random()*Game.height);\n                  \tspawn(instanceTwo, Game.width, randY, character.getvector(-Game.width, -randY, character.x, character.y).direction);\n                  \tcharacter.custom.targets = 0;\n              \t\tcharacter.custom.lasthad = Game.time;\n                }\n            }\n          \tif (Game.time % 4 == 0 && Game.time > 5 && character.custom.targets == 0 && character.custom.lasthad < Game.time){\n             \tif (character.name == 'planet'){\n                  \tcharacter.custom.targets = 1;\n                }\n            }\n          \t\n            //#Key-Events\n            if (Game.key['KeyW'] && character.input['KeyW']){\n              \tcharacter.direction = 0;\n                character.move(1);\n            }\n          \tif (Game.key['KeyA'] && character.input['KeyA']){\n              \tcharacter.direction = 270;\n                character.move(1);\n            }\n          \tif (Game.key['KeyS'] && character.input['KeyS']){\n              \tcharacter.direction = 180;\n                character.move(1);\n            }\n          \tif (Game.key['KeyD'] && character.input['KeyD']){\n              \tcharacter.direction = 90;\n                character.move(1);\n            }\n          \tif (Game.click && character.input['Click'] && character.custom.bullets){\n              \tinstanceOne.playsound(false, '../assets/shoot.mp3');\n    \t\t\tspawn(instanceOne, character.x+(character.width/2), character.y+(character.height/2), character.getvector(-character.x, -character.y, Game.mousePosition.x, Game.mousePosition.y).direction);\n              \tcharacter.custom.bullets = 0;\n              \tcharacter.custom.lastshot = Game.time;\n              \tGame.click = false;\n            }\n          \t\n            for (box in Game.collisionGraph) {\n              \tvar collider = Game.assets[box];\n            \tif (character.name != collider.name){\n                \tif (((character.x <= collider.x+collider.width && character.x >= collider.x) || (character.x+character.width >= collider.x && character.x+character.width <= collider.x+collider.width)) && ((character.y <= collider.y+collider.height && character.y >= collider.y) || (character.y+character.height >= collider.y && character.y+character.height <= collider.y+collider.height))){\n                    \t//#Collision-Events\n                      \tif (character.name == 'rock' && collider.name == 'bullet'){\n                          \tcharacter.playsound(false, '../assets/shoot.mp3');\n                          \tcharacter.showimage('../assets/explode.png', asset);\n                          \tcharacter.custom.destroyed = Game.time;\n                        }\n                      \tif (character.name == 'ship' && collider.name == 'rock'){\n                          \tcharacter.playsound(false, '../assets/death.mp3');\n                        }\n                      \tif (character.name == 'rock' && collider.name == 'planet'){\n                          \tcharacter.playsound(false, '../assets/game_over.mp3');\n                          \tcharacter.showimage('../assets/explode.png', asset);\n                          \tcharacter.custom.destroyed = Game.time;\n                        }\n                    }\n            \t}\n           \t};\n          \n            if (character.name == 'bullet'){\n          \t\tcharacter.move(3);\n              \tif (character.x > Game.width || character.y > Game.height){\n                  \tdespawn(asset);\n                }\n            }\n          \n          \tif (character.name == 'ship'){\n              \tcharacter.direction = character.getvector(-character.x, -character.y, Game.mousePosition.x, Game.mousePosition.y).direction;\n              \tif (character.custom.bullets == 0 && (Game.time - character.custom.lastshot) > 1){\n                \tcharacter.custom.bullets = 1;\n                }\n              \tif (character.custom.bullets == 1){\n                  \tcharacter.showtext(cursor, 'ready to fire, sir!', 20, 'bottom');\n                } else {\n                  \tcharacter.showtext(cursor, '...loading missile', 20, 'bottom');\n                }\n            }\n          \t\n          \tif (character.name == 'rock'){\n              \tif ((Game.time - character.custom.destroyed) == 2){\n              \t\tdespawn(asset);\n                  \tcharacter.custom.destroyed = 0;\n                  \tvar randY = Math.floor(Math.random()*Game.height);\n                  \tspawn(instanceTwo, Game.width, randY, collisionOne.getvector(-Game.width, -randY, collisionOne.x, collisionOne.y).direction);\n                }\n              \tif (character.custom.destroyed == 0) {\n                  \tcharacter.move(1);\n                }\n              \tif (character.x < 0){\n                 \tdespawn(asset);\n                }\n            }\n          \t\n        };\n    } else {\n        window.cancelAnimationFrame(gameLoop);\n    }   \n}";
                localStorage[pname+"_ct"] = charactersjs;
                localStorage[pname+"_lt"] = loopjs;
                break;
            case "vertical":
                var charactersjs = "// template not ready";
                var loopjs = "// template not ready";
                localStorage[pname+"_ct"] = charactersjs;
                localStorage[pname+"_lt"] = loopjs;
                break;
            case "horizontal":
                var charactersjs = "// template not ready";
                var loopjs = "// template not ready";
                localStorage[pname+"_ct"] = charactersjs;
                localStorage[pname+"_lt"] = loopjs;
                break;
            case "platformer":
                var charactersjs = "// template not available";
                var loopjs = "// template not available";
                localStorage[pname+"_ct"] = charactersjs;
                localStorage[pname+"_lt"] = loopjs;
                break;
            case "isometric":
                var charactersjs = "// template not available";
                var loopjs = "// template not available";
                localStorage[pname+"_ct"] = charactersjs;
                localStorage[pname+"_lt"] = loopjs;
                break;
        
            default:
                break;
        }

    } else if (ptype = "3d") {
        localStorage[pname] = "3d";
    }

    //then open project
    openProject(pname, ptype);
}